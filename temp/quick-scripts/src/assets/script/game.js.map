{"version":3,"sources":["assets\\script\\game.js"],"names":["cc","Class","Component","properties","cellPrefab","Prefab","cellAreaNode","Node","onLoad","maxSize","maxWCnt","width","maxHCnt","height","tt","pause","cellNodeArr","i","j","cellNode","instantiate","setPosition","v2","getComponent","setState","addChild","on","onTouchStart","e","pos","getLocation","n_pos","convertToNodeSpaceAR","parseInt","y","x","switchState","start","update","dt","lifeChange","pauseGame","text","find","Label","sring","nowStateMap","nextStateMap","cellState","state","cellLifeCheck","stateMap","index","grid","totalLife","g"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        cellPrefab: cc.Prefab,\r\n        cellAreaNode: cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.maxSize = 10;\r\n        this.maxWCnt = this.cellAreaNode.width / this.maxSize;\r\n        this.maxHCnt = this.cellAreaNode.height / this.maxSize;\r\n\r\n        this.tt = 0;\r\n        // 暂停\r\n        this.pause = true;\r\n\r\n        // 用一个二维数组来记录 小方块\r\n        this.cellNodeArr = [];\r\n\r\n        for (let i = 0; i < this.maxHCnt; i++) {\r\n            this.cellNodeArr[i] = [];\r\n            for (let j = 0; j < this.maxWCnt; j++) {\r\n                let cellNode = cc.instantiate(this.cellPrefab);\r\n                cellNode.setPosition(cc.v2(j * this.maxSize, i * this.maxSize));\r\n                cellNode.getComponent('cell').setState(0);\r\n                this.cellAreaNode.addChild(cellNode);\r\n                this.cellNodeArr[i][j] = cellNode;\r\n            }\r\n        }\r\n\r\n        this.cellAreaNode.on('touchstart', this.onTouchStart, this);\r\n    },\r\n\r\n    onTouchStart(e) {\r\n        // 获取点击处的位置坐标\r\n        let pos = e.getLocation();\r\n        // 将点击处的坐标转换成 cellArea 内部的坐标\r\n        let n_pos = this.cellAreaNode.convertToNodeSpaceAR(pos);\r\n\r\n        // 获取点击的小方块 cell 坐标\r\n        let i = parseInt(n_pos.y / this.maxSize);\r\n        let j = parseInt(n_pos.x / this.maxSize);\r\n\r\n        let cellNode = this.cellNodeArr[i][j];\r\n        cellNode.getComponent('cell').switchState();\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.pause) return;\r\n        this.tt += dt;\r\n        if (this.tt >= 0.1) {\r\n            this.tt = 0;\r\n            this.lifeChange();\r\n        }\r\n    },\r\n\r\n    // 开始按钮触发的方法\r\n    pauseGame() {\r\n        this.pause = !this.pause;\r\n        var text = this.pause ? 'Pause' : 'Start';\r\n        cc.find('Canvas/bg/pauseBtn/Background/Label').getComponent(cc.Label).sring = text;\r\n    },\r\n\r\n    lifeChange() {\r\n        let nowStateMap = []; // 当前细胞的状态\r\n        let nextStateMap = []; // 下一次细胞的状态\r\n\r\n        for (let i = 0; i < this.maxHCnt; i++) {\r\n            nowStateMap[i] = [];\r\n            nextStateMap[i] = [];\r\n            for (let j = 0; j < this.maxWCnt; j++) {\r\n                let cellState = this.cellNodeArr[i][j].getComponent('cell').state;\r\n                nowStateMap[i][j] = cellState;\r\n                nextStateMap[i][j] = cellState;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.maxHCnt; i++) {\r\n            for (let j = 0; j < this.maxWCnt; j++) {\r\n                let state = this.cellLifeCheck(nowStateMap, { i, j });\r\n                // 处理细胞状态\r\n                if (state == 1 || state == 0) {\r\n                    nextStateMap[i][j] = state;\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        for (let i = 0; i < this.maxHCnt; i++) {\r\n            for (let j = 0; j < this.maxWCnt; j++) {\r\n                let cellState = nextStateMap[i][j];\r\n                this.cellNodeArr[i][j].getComponent('cell').setState(cellState);\r\n            }\r\n        }\r\n    },\r\n\r\n    cellLifeCheck(stateMap, index) {\r\n        // 偏移量\r\n        let grid = [\r\n            { i: 1, j: -1 }, { i: 1, j: 0 }, { i: 1, j: 1 },\r\n            { i: 0, j: -1 }, { i: 0, j: 1 },\r\n            { i: -1, j: -1 }, { i: -1, j: 0 }, { i: -1, j: 1 }\r\n        ];\r\n\r\n        let totalLife = 0;\r\n\r\n        for (let g of grid) {\r\n            let i = g.i + index.i;\r\n            let j = g.j + index.j;\r\n\r\n            // 溢出范围处理\r\n            if (i >= this.maxHCnt) {\r\n                i = 0;\r\n            }\r\n            if (j >= this.maxWCnt) {\r\n                j = 0;\r\n            }\r\n            if (i < 0) {\r\n                i = this.maxHCnt - 1;\r\n            }\r\n            if (j < 0) {\r\n                j = this.maxWCnt - 1;\r\n            }\r\n\r\n            let cellState = stateMap[i][j];\r\n            if (cellState != 0) totalLife++;\r\n        }\r\n        if (totalLife == 3) {\r\n            return 1;//存活\r\n        } else if (totalLife == 2) {\r\n            return -1;//不变\r\n        } else {\r\n            return 0;//死亡\r\n        }\r\n    },\r\n\r\n});\r\n"]}